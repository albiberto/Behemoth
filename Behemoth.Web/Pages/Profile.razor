@page "/profile"

@using Behemoth.Contracts
@using Behemoth.Web.Handlers

@inject ISnackbar Snackbar
@inject BehemothHttpClient ProfileClient

<PageTitle>Profilo Utente</PageTitle>

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-4">
    <MudText Typo="Typo.h4" GutterBottom="true">Il Mio Profilo</MudText>

    @if (isLoading)
    {
        <MudProgressCircular Color="Color.Primary" Indeterminate="true"/>
    }
    else if (model != null)
    {
        <MudCard>
            <MudCardContent>
                <MudStack Spacing="3">
                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="4">
                        <MudAvatar Size="Size.Large" Style="width: 100px; height: 100px;">
                            @if (!string.IsNullOrEmpty(model.AvatarUrl))
                            {
                                <MudImage Src="@model.AvatarUrl" Alt="Avatar"/>
                            }
                            else
                            {
                                <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Large"/>
                            }
                        </MudAvatar>

                        <MudFileUpload T="IBrowserFile" Accept="image/*" FilesChanged="OnAvatarSelected"
                                       MaximumFileCount="1">
                            <ActivatorContent>
                                <MudButton Variant="Variant.Filled"
                                           Color="Color.Primary"
                                           StartIcon="@Icons.Material.Filled.CloudUpload"
                                           Disabled="isUploadingAvatar">
                                    @(isUploadingAvatar ? "Caricamento..." : "Cambia Avatar")
                                </MudButton>
                            </ActivatorContent>
                        </MudFileUpload>
                    </MudStack>

                    <MudTextField @bind-Value="model.Username"
                                  Label="Nome Utente"
                                  Variant="Variant.Outlined"
                                  Required="true"/>

                    <MudTextField @bind-Value="model.Bio"
                                  Label="Biografia"
                                  Variant="Variant.Outlined"
                                  Lines="4"
                                  MaxLength="500"/>
                </MudStack>
            </MudCardContent>

            <MudCardActions>
                <MudButton Variant="Variant.Filled"
                           Color="Color.Primary"
                           OnClick="SaveAsync"
                           Disabled="isSaving">
                    @(isSaving ? "Salvataggio..." : "Salva Modifiche")
                </MudButton>
            </MudCardActions>
        </MudCard>
    }
    else
    {
        <MudAlert Severity="Severity.Error">Impossibile caricare il profilo.</MudAlert>
    }
</MudContainer>